<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <!-- <meta http-equiv="content-type" content="text/html; charset=iso-8859-2" /> -->
    <meta charset="UTF-8">
    <title>Projekt IIS</title>
    <style type="text/css">
      table {
        border-collapse: collapse;
      }
      td,
      th {
        border: 1px solid black;
        padding: 0.3em 0.5em;
        text-align: left; 
      }
      dt {
        font-weight: bold;
        margin-top: 0.5em;
      }
    </style>
  </head>
  <body>
    <!-- Zkontrolujte prosím nastavení kódování v hlavičce dokumentu 
     podle použitého editoru -->

    <h1>FITstagram</h1>
    <!-- Nahradte názvem svého zadání -->

    <dl>
      <dt>Autoři</dt>
      <dd>
        Lukáš Witpeerd
        <!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
        <a href="mailto:xwitpe00@stud.fit.vutbr.cz"
          >xwitpe00@stud.fit.vutbr.cz</a
        >
        - Frontend
      </dd>
      <dd>
        Dominik Huml
        <!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
        <a href="mailto:xhumld00@stud.fit.vutbr.cz"
          >xhumld00@stud.fit.vutbr.cz</a
        >
        - Backend
      </dd>
      <dd>
        Matyáš Krejza
        <!-- Nahraďte skutečným jménem a e-mailem autora a popisem činnosti -->
        <a href="mailto:xkrejz07@stud.fit.vutbr.cz"
          >xkrejz07@stud.fit.vutbr.cz</a
        >
        - Backend - Dokumentace
      </dd>
      <dt>URL aplikace</dt>
      <dd>
        <a href="https://iis.lufy.cz"
          >https://iis.lufy.cz</a
        >
      </dd>
      <dd>
        (pokud má aplikace více vstupních stránek, napište obdobně další URL)
      </dd>
    </dl>

    <h2>Uživatelé systému pro testování</h2>
    <p>
      Uveďte prosím existující zástupce <strong>všech rolí uživatelů</strong>.
    </p>
    <table>
      <tr>
        <th>Login</th>
        <th>Heslo</th>
        <th>Role</th>
      </tr>
      <tr>
        <td>matyas</td>
        <td>test</td>
        <td>administrator</td>
      </tr>
      <tr>
        <td>lukas</td>
        <td>test</td>
        <td>moderator</td>
      </tr>
      <tr>
        <td>dominik</td>
        <td>test</td>
        <td>regular</td>
      </tr>
    </table>

    <p>
      (Diagram případů užití není nutné vkládat, pokud IS implementuje role a
      případy užití definované zadáním.)
    </p>

    <h3>Video</h3>

    <a href="https://www.youtube.com/watch?v=G6vU8hkEmWo"
    >https://www.youtube.com/watch?v=G6vU8hkEmWo</a
  >

    <h2>Implementace</h2>

    <p>
      <h3>
        Frontend
      </h3>

      Frontend využívá framework NextJS a napsán v TypeScriptu. Některé komponenty (ty ve složce src/components) jsou
      vypůjčené z ui knihovny Sushi (víceméně stylování + Radix-UI).

      <h4>Instalace frontendu</h4>
      <ol>
        <li>Závislosti: node v18 a pnpm</li>
        <p>apt install nodejs npm</p>
        <p>npm install -g pnpm</p>
        <p>pnpm i</p>
        <li>Prosředí</li>
        <p>Je třeba vytvořit .env soubor dle vzoru z .env.sample</p>
        <li>Build</li>
        <p>pnpm build</p>
        <li>Spuštění</li>
        <p>pnpm start</p>
      </ol>
    </p>

    <p>
      <h3>
       Backend 
      </h3>
      Backend je rozdělen do několika samostatných modulů.
      <ul>
        <li><b>models</b></li>
        <ul>
          <li>schema - objekty které reprezentují databázové tabulky, mapping pomocí ORM</li>
          <li>domain - doménové objekty, je v nich zapouzdřena logika a validace</li>
        </ul>
        <li><b>migration</b> - migrační soubory potřebné pro vytvoření databáze</li>
        <li><b>repository</b> - repozitáře pro jednotlivé doménové entity, manipulují s daty</li>
        <li><b>usecase</b> - implementace jednotlivých případů užití, obdrží přes DI repozitáře a následně vykonávají veškeré akce</li>
        <li><b>api</b> - implentace HTTP endpointů, volají se zde jednotlivé "use_casy"</li>
        <ul>
          <li>routes - implementace kontrolerů a směrování</li>
          <li>extractors - extraktory pro manipulaci s HTTP požadavky</li>
        </ul>
      </ul>

      <h4>Autentikace</h4>
      Autentikace probíhá pomocí JWT tokenů, ten se na klientovi uchovává v <b>HttpOnly</b> a <b>Secure</b> cookie, pro vyšší bezpečnost. JWT token v sobě obsahuje základní informace, jako jméno uživatele a role.
      Pro invalidaci tokenu se využívá Redis úložistě, kde je token po dobu své platnosti "blacklistnut".

    </p>

    <h3>Databáze</h3>

    <img
      src="images/iis_diagram.drawio.svg"
    >
      Diagram
    </img>

    <h2>Instalace</h2>

    Stručně popište:
    <ul>
      <li>postup instalace na server,</li>
      <li>softwarové požadavky (verze PHP apod.),</li>
      <li>jak rozbalit, konfigurovat, inicializovat databázi, ...</li>
    </ul>

    <h4>Instalace backendu</h4>
    <ol>
      <li>Instalace <a href="https://docs.docker.com/engine/install/">Docker</a> a <a href="https://docs.docker.com/compose/install/"> Docker compose</a></li>
      <li>Stáhnutí závislostí pro rust </li>
      <p>curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</p>
      <p>cargo install sea-orm-cli</p>
      <li>Spuštění databáze a Redisu (v root adresáři)</li>
      <p>sudo docker compose up -d</p>
      <li>Spuštění migrací (v backend adresáři)</li>
      <p>sea-orm-cli migrate up</p>
      <li>Spuštění aplikace (v backend adresáři)</li>
      <p>cargo shuttle run</p>
    </ol>

    <h3>SW požadavky</h3>
    <ul>
      <li>postgreSQL: 14</li>
      <li>redis: 7.4</li>
      <li>rustc kompilátor: 1.80</li>
    </ul>

    <h3>Inicializace databáze</h3>
    Pokud databáze bude vytvořena pomocí migrací, vytvoří se potřebné tabulky, ale bez dat. Pokud ji chceme inicializovat, tak existuje skript na vytvoření všech tabulek a vložení dat, cesta k němu je <b>./backend/scripts/create.sql</b>. V takovém případě se pak migrace nepoužívá.

    <h3>Konfigurace</h3>
    Pro správný chod aplikace je potřeba inicializovat proměnné prostředí. Pro backend je šablona umístěnná v <b>./backend/.env.template</b>. Konfigurace se pak bude nacházet v <b>./backend/.env</b>
    Vysvětlení položek:
    <ul>
      <li>DATABASE_URL: adresa databáze</li>
      <li>REDIS_URL: adresa redisu</li>
      <li>FRONTEND_URL: adresa frontendu</li>
      <li>JWT_SECRET: šifrovací klíč pro JWT</li>
    </ul>

    

    <h3>Ukládání obrázků</h3>
    Pro ukládání obrázku využíváme službu Cloudinary. Je to služba pro ukládání a transformaci obrázků v cloudu. Pro inicializaci je potřeba specifikovat proměnné prostředí <b>CLOUDINARY_CLOUD_NAME</b>, <b>CLOUDINARY_API_KEY</b> a <b>CLOUDINARY_API_SECRET</b> v souboru /backend/.env viz templete v předchozím bodu.

    <h2>Známé problémy</h2>
    <p>
      Zde popište, které body zadání nejsou implementovány a z jakého důvodu.
      Např. &bdquo;Z časových důvodů nebyla implementována správa
      uživatelů.&rdquo; Pomůžete tím zrychlit hodnocení, když neimplementované
      funkce nebudeme muset dlouze hledat.
    </p>


  </body>
</html>
